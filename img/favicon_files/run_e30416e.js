define("common:widget/shitu/run",function(t,e,i){function s(){this.homeForm=document.getElementById("homeSearchForm"),this.point=document.getElementById("point"),this.content=document.getElementById("stsug"),this.submitobj=document.getElementById("sbobj"),this.form=document.getElementById("form1"),this.form2=document.getElementById("form2"),this.shituvalue=document.getElementById("shitu1"),this.shituvalue2=document.getElementById("shitu2"),this.file=document.getElementById("stfile"),this.url=document.getElementById("stuurl"),this.entry=document.getElementById("sttb"),this.stTipsBox=document.getElementById("stTipsBox"),this.stTipArrowIn=document.getElementById("stTipArrowIn"),this.stTipArrowOut=document.getElementById("stTipArrowOut"),this.shituAd=document.getElementById("shituEnter"),this.close=document.getElementById("closest"),this.cancelButton=document.getElementById("cancelst"),this.tips=document.getElementById("stmore"),this.dttip=document.getElementById("dttip"),this.undragtip=document.getElementById("undragtip"),this.untip=document.getElementById("untip"),this.hpobj=document.getElementById("hp"),this.sthp=document.getElementById("sthelp"),this.draghp=document.getElementById("dragtip"),this.kw=document.getElementById("kw"),this.dragts=document.getElementById("dragtg"),this.clickurl="http://stu.baidu.com",this.onuploadtg=0,this.ftn=document.getElementById("stftn").value||"",this.isDisplay="shitu-index"===window.tn?1:0,this.isSubmit=0,this.isdrag=!0,this.chrome=/chrome\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0,this.safari=/Safari\/(\d+\.\d+)/i.test(navigator.userAgent)?+RegExp.$1:void 0,this.isIe=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]),isNaN(this.isIe)&&(this.isIe=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1])),this.isOpera=/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,this.isIE6789=o.browser.msie&&o.browser.version<=9,this.callbacks={aftershow:{},beforehide:{}},this.isFromSt="shitu"===a.getQueryValue("fr"),this.isShowSt=!1,this.animate=new r(o("#mock-stsug"))}var n,o=t("common:widget/ui/base/base"),a=t("common:widget/ui/utils/utils"),r=t("common:widget/shitu/static/animate");o.extend(s.prototype,{init:function(){var t=this,e=t.addEvent,i=t.content;this.initDisplay(),"index"===window.tn&&t.initTipsStatus(),"shitu-index"===window.tn&&t.initHomeStatus(),this.safari&&!this.chrome&&("index"===window.tn?this.dttip.style.opacity=0:this.dttip.style.display="none"),e(window,"load",function(){t.initDisplay()}),e(document,"click",function(e){if("shitu-index"!==window.tn){var i=!!t.isShowSt;t.hideContent(e,0)&&(window.setTimeout(function(){t.isDisplay||t.isSubmit||t.closest()},10),i&&t.afterCloseSt())}}),e(document,"mousemove",function(e){t.hideContent(e,1)&&window.setTimeout(function(){t.isDisplay||t.isSubmit||!t.isdrag||t.closest()},10)}),t.entry&&e(t.entry,"click",function(e){t.preventDefault(e),"index"===window.tn&&t.showStTips(!1);var i=o(t.entry),s=i.position();s.left=s.left+i.width()/2,s.top=s.top+i.height()/2,t.animate.showAnimation(s,function(){t.isDisplay=1,t.displayst(!0)})}),t.sthp&&e(t.sthp,"mouseover",function(e){t.preventDefault(e),t.stopPropagation(e),t.tips.style.display="block"}),t.sthp&&e(t.sthp,"mouseout",function(){n=setTimeout(function(){t.tips.style.display="none"},500)}),t.tips&&e(t.tips,"mouseover",function(e){e=window.event||e,t.fixedMouse(e,t.tips)&&n&&clearTimeout(n)}),t.tips&&e(t.tips,"mouseout",function(e){e=window.event||e,t.fixedMouse(e,t.tips)&&(t.tips.style.display="none")}),e(t.file,"change",function(){t.file.files.length>0&&t.getValue(),t.file.value=""}),t.entry&&e(t.entry,"mouseover",function(){t.closeStTipsTimer&&(clearTimeout(t.closeStTipsTimer),t.closeStTipsTimer=null),t.showStTips(!0)}),t.entry&&e(t.entry,"mouseout",function(){t.showStTips(!1)}),e(t.submitobj,"click",function(e){var i=/^(\s)*(http|https):\/\//,s=t.url.value,n=!i.test(s)||!t.checkImgType(s);e=window.event||e,""!=s&&("result"===window.tn&&p?p(null,1111103,{pos:"paste",fm:"searchresult"}):"detail"===window.tn&&statistic&&statistic.send("5.1011103",{pos:"drag",fm:"searchdetail"})),n?(o(".stuwr").addClass("warn"),setTimeout(function(){o(".stuwr").removeClass("warn")},2e3),this.form.reset()):(o.cookie("uploadTime",(new Date).getTime(),{path:"/"}),t.shituvalue.value="paste",t.submitForm(!0,t.form,"urlSearch"),t.point.style.display="block"),t.preventDefault(e)}),t.close&&e(t.close,"click",function(e){t.stopPropagation(e),t.isIe?window.document.execCommand("Stop"):window.stop(),t.form.reset(),t.form2.reset();var i="btn";t.closest(i),t.afterCloseSt()}),!t.isOpera&&window.FileReader&&(e(t.url,"paste",function(e){var i=e.clipboardData||window.clipboardData,s=i.items,n=i.types;if(s&&s.length&&n&&n.length)for(var o in s)if("file"===s[o].kind)return t.shituUploadByHtml5(s[o].getAsFile())}),e(document,"dragenter",function(){t.point.style.display="none",t.displayst(),t.safari&&!t.chrome||(t.draghp.style.display="")}),e(document,"dragover",function(){t.point.style.display="none",t.displayst(),t.safari&&!t.chrome||(t.draghp.style.display="")}),e(i,"dragenter",function(e){t.preventDefault(e),t.stopPropagation(e)}),e(i,"dragover",function(e){t.preventDefault(e),t.stopPropagation(e)}),e(i,"drop",function(e){if(t.preventDefault(e),t.stopPropagation(e),t.safari&&!t.chrome)return t.close.style.display="block",t.undragtip.style.display="block",void(t.isdrag=!1);if(o.cookie("uploadTime",(new Date).getTime(),{path:"/"}),t.isSubmit=1,"result"===window.tn&&p?p(null,1111101,{pos:"drag",fm:"searchresult"}):"detail"===window.tn&&statistic&&statistic.send("5.1011101",{pos:"drag",fm:"searchdetail"}),e.dataTransfer.files.length)try{t.shituUploadByHtml5(e.dataTransfer.files[0])}catch(i){return}else if(e.dataTransfer.types.indexOf&&-1!=e.dataTransfer.types.indexOf("text/html")||e.dataTransfer.types.contains&&-1!=e.dataTransfer.types.contains("text/html")){var s=document.createElement("div");s.innerHTML=e.dataTransfer.getData("text/html");var n=s.getElementsByTagName("img");if(!(n&&n[0]&&n[0].src))return;var a=document.createElement("input");a.name="drag",a.value="1",a.type="hidden",t.form.appendChild(a),t.shituvalue.value="drag",0==n[0].src.indexOf("data:")?(t.url.value=n[0].getAttribute("data-imgurl")||n[0].src,t.submitForm(!0,t.form,"urlSearch")):(t.url.value=n[0].src,t.submitForm(!0,t.form,"urlSearch"))}else{if(!e.dataTransfer.types.indexOf||-1==e.dataTransfer.types.indexOf("text/uri-list"))return;t.url.value=e.dataTransfer.getData("text/uri-list"),t.submitForm(!0,t.form,"urlSearch")}t.point.style.display="block"}),t.cancelButton&&e(t.cancelButton,"click",function(e){t.stopPropagation(e),t.isIe?window.document.execCommand("Stop"):window.stop(),t.form.reset(),t.form2.reset(),t.isSubmit=0,t.draghp.style.display="none",t.point.style.display="none",t.onuploadtg=0,t.isDisplay||t.closest()}))},sendSpeedLog:function(t){var e=new Image,i="//imgstat.baidu.com/6.gif?",s=o.extend({_dev:"pc",speed:"shitu",shituvs:window.vsid},t),n=0;for(var a in s)i+=0===n?a+"="+s[a]:"&"+a+"="+s[a],n++;e.src=i+"&_="+(Date.now?Date.now():+new Date)},getFm:function(){var t="";switch(window.tn){case"index":t="index";break;case"result":t="searchresult";break;case"detail":t="searchdetail";break;case"shitu-index":t="home"}return t},getRange:function(){var t="";switch(window.tn){case"result":t='{"page_from": "imagePage"}';break;case"detail":t='{"page_from": "imageView"}';break;case"index":t='{"page_from": "imageIndex"}';break;case"shitu-index":t='{"page_from": "shituIndex"}'}return t},shitu2jump:function(t){var e=this;o.ajax({url:"https://graph.baidu.com/upload?image="+encodeURIComponent(t)+"&tn=pc&from=pc&image_source=PC_UPLOAD_URL&range="+this.getRange()+"&extUiData%5bisLogoShow%5d=1",type:"post",success:function(t){0===t.status?location.assign(t.data.url):1002===t.status?(alert("未找到该图片的详细信息，请上传其他图片"),e.hideLoading()):(alert("出错了！（规则未定）"),e.hideLoading())},error:function(){alert("网络问题，请稍候再试！"),e.hideLoading()}})},shituUploadByForm:function(t){var e=this,i=this.file;if(i.files&&i.files[0].size>=10485760)return alert("上传的图片大小不能超过10M"),e.hideLoading();e.showLoading();var s={url:"https://graph.baidu.com/upload?tn=pc&from=pc&image_source=PC_UPLOAD_IMAGE_FILE&range="+this.getRange()+"&extUiData%5bisLogoShow%5d=1",type:"post",success:function(t){0===t.status?location.assign(t.data.url):1002===t.status?(alert("未找到该图片的详细信息，请上传其他图片"),e.hideLoading()):(alert("相关规则暂时未定"),e.hideLoading())},error:function(){alert("网络问题，请稍候再试！"),e.hideLoading()}};o(t).ajaxSubmit(s)},shituUploadByHtml5:function(t){var e=this;if(!e.isOpera){if(t&&t.size>=10485760)return alert("拖动的图片大小不能超过10M"),e.hideLoading();e.showLoading();var i=new FormData;o.each(t,function(t,e){i.append(t,e)}),i.append("image",t,t.name),this.sendSpeedLog({uptype:"drag",pos:1}),o.ajax({url:"https://graph.baidu.com/upload?tn=pc&from=pc&image_source=PC_UPLOAD_IMAGE_MOVE&range="+this.getRange()+"&extUiData%5bisLogoShow%5d=1",type:"post",data:i,processData:!1,contentType:!1,success:function(t){0===t.status?location.assign(t.data.url):1002===t.status?(alert("未找到该图片的详细信息，请上传其他图片"),e.hideLoading()):(alert("出错了！（规则未定）"),e.hideLoading())},error:function(){alert("网络问题，请稍候再试！"),e.hideLoading()}})}},initDisplay:function(){this.entry&&(this.entry.style.display=""),this.dragts&&this.closedg(),this.form&&this.form.reset(),this.form2&&this.form2.reset(),this.point&&(this.point.style.display="none"),this.isFromSt&&(this.isDisplay=1,this.displayst(!0))},initTipsStatus:function(){var t=this,e=o.cookie("firstShowTip")||o.cookie.get("firstShowTip");"1"===e?t.showStTips(!1):(o.cookie.set("firstShowTip",1),t.autoCloseStTips())},initHomeStatus:function(){this.close.style.display="none"},autoCloseStTips:function(){var t=this;t.closeStTipsTimer=null,t.closeStTipsTimer=setTimeout(function(){t.showStTips(!1),t.closeStTipsTimer=null},5e3)},closedg:function(){var t=this;(t.isOpera||!window.FileReader)&&this.dragts&&(this.dragts.style.display="none")},openContent:function(){var t=this;t.isDisplay=1,t.displayst(!0)},hideContent:function(t,e){for(var t=window.event||t,i=t.srcElement||t.target;i&&"BODY"!==i.tagName&&"HTML"!==i.tagName&&i.getAttribute;){var s=i.getAttribute("id");if("stcontent"==s)return!1;i=i.parentNode}return 0===e?(this.closest(),!0):(this.draghp.style.display="none",!0)},fixedMouse:function(t,e){var i,s=t.type.toLowerCase();if("mouseover"==s)i=t.relatedTarget||t.fromElement;else{if("mouseout"!=s)return!0;i=t.relatedTarget||t.toElement}return i&&"xul"!=i.prefix&&!this.contains(e,i)&&i!==e},contains:function(t,e){return t.contains?t!=e&&t.contains(e):!!(16&t.compareDocumentPosition(e))},addEvent:function(t,e,i){if(t.attachEvent){var s=e+i;t[s]=function(){i(window.event)},t.attachEvent("on"+e,t[s])}else t.addEventListener(e,i,!1)},removeEvent:function(t,e,i){if(t.detachEvent){var s=e+i;t.detachEvent("on"+e,t[s]),t[s]=null}else t.removeEventListener(e,i,!1)},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},showStTips:function(t){t?(this.stTipsBox.style.display="block",this.stTipArrowOut.style.display="block",this.stTipArrowIn.style.display="block"):(this.stTipsBox.style.display="none",this.stTipArrowOut.style.display="none",this.stTipArrowIn.style.display="none")},closest:function(t){var e=this;!this.isdrag&&t?(this.undragtip.style.display="none",this.untip.style.display="none",this.close.style.display="none",setTimeout(function(){e.isdrag=!0},300)):(!t||this.isdrag&&t)&&(this.content.style.display="none",this.undragtip.style.display="none",this.untip.style.display="none",this.hpobj&&(this.hpobj.style.display=""),this.isDisplay=0,this.homeForm&&(this.homeForm.style.visibility="visible"),this.entry&&(this.entry.style.visibility="visible"),this.isShowSt=!1)},displayst:function(t){this.point.style.display="none",this.isIE6789&&(this.untip.style.display="block"),this.content.style.display="",this.isdrag=!0,this.hpobj&&(this.hpobj.style.display="none"),t&&this.url.focus(),this.homeForm&&(this.homeForm.style.visibility="hidden"),this.entry&&(this.entry.style.visibility="hidden"),this.isShowSt=!0,o.browser.msie&&o(this.url).focus(function(){var t=o(this);t.val()===t.attr("placeholder")&&(t.val(""),t.removeClass("placeholder"))}).blur(function(){var t=o(this);(""===t.val()||t.val()===t.attr("placeholder"))&&(t.addClass("placeholder"),t.val(t.attr("placeholder")))}).blur()},afterCloseSt:function(){if("shitu-index"!==window.tn){var t=o(this.entry),e=t.position();e.left=e.left+t.width()/2,e.top=e.top+t.height()/2;var i=this;this.animate.hideAnimation(e,function(){"index"!==window.tn&&(i.showStTips(!0),setTimeout(function(){i.showStTips(!1)},1e3)),i.form.reset(),i.form2.reset()})}},checkImgType:function(t){return!0},getValue:function(){var t=this.file,e=this.point,i=this.form2;e.style.display="none";var s=t.value,n=""!=s&&this.checkImgType(s);this.shituvalue2.value="upload",this.submitForm(n,i,"uploadSearch")},submitForm:function(t,e,i){return t?("index"===window.tn?window.ss&&window.ss({type:"searchNum",p:i,form:"wantu"}):"result"===window.tn?(e.fm.value="searchresult",window.ss&&window.ss({type:"searchNum",p:i,form:"searchresult"})):"detail"===window.tn?(e.fm.value="searchdetail",window.ss&&window.ss({type:"searchNum",p:i,form:"searchDetail"})):"shitu-index"===window.tn&&(e.fm.value="home"),this.entry&&(this.entry.style.zIndex="2"),this.point.style.display="block",this.onuploadtg=1,this.submit2shitu(e),this.safari&&!this.chrome&&setTimeout(function(){this.point.style.display="none"},500),!0):(alert("您的文件格式不正确或图片网址过长。支持jpg、gif、png、jpeg、bmp格式图片及250个字符内的图片网址。"),this.point.style.display="none",this.draghp.style.display="none",e.reset(),!1)},submit2shitu:function(t){"form1"===t.id?this.shitu2jump(this.url.value,this.shituvalue.value):this.shituUploadByForm("#form2")},showLoading:function(){this.point.style.display="block"},hideLoading:function(){this.point.style.display="none"},on:function(t,e,i){this.callbacks[t]&&(this.callbacks[t][e]=i)},fire:function(t,e){this.callbacks[t]&&(this.callbacks[t][e]=null,delete this.callbacks[t][e])}}),i.exports=s});